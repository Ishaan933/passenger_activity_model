<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transit Prediction Model</title>
    <script>
        async function updateRouteNames() {
            const routeNumber = document.getElementById('route_number').value;
            console.log('Selected route number:', routeNumber);
            
            try {
                const response = await fetch('/get_route_names', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ route_number: routeNumber })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const routeNames = await response.json();
                console.log('Received route names:', routeNames);

                const routeNameDropdown = document.getElementById('route_name');
                routeNameDropdown.innerHTML = ''; // Clear existing options
                routeNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    routeNameDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error updating route names:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const routeNumberDropdown = document.getElementById('route_number');
            routeNumberDropdown.addEventListener('change', updateRouteNames);
        });
    </script>
</head>
<body>
    <h1>Transit Prediction Model</h1>
    <form action="/predict" method="POST">
        <label for="schedule_period_name">Schedule Period Name:</label>
        <select id="schedule_period_name" name="schedule_period_name" required>
            {% for period in schedule_periods %}
                <option value="{{ period }}">{{ period }}</option>
            {% endfor %}
        </select><br>

        <label for="route_number">Route Number:</label>
        <select id="route_number" name="route_number" required>
            {% for number in route_numbers %}
                <option value="{{ number }}">{{ number }}</option>
            {% endfor %}
        </select><br>

        <label for="route_name">Route Name:</label>
        <select id="route_name" name="route_name" required>
            <!-- Route names will be populated dynamically -->
        </select><br>

        <label for="day_type">Day Type:</label>
        <select id="day_type" name="day_type" required>
            {% for day in day_types %}
                <option value="{{ day }}">{{ day }}</option>
            {% endfor %}
        </select><br>

        <label for="time_period">Time Period:</label>
        <select id="time_period" name="time_period" required>
            {% for period in time_periods %}
                <option value="{{ period }}">{{ period }}</option>
            {% endfor %}
        </select><br>

        <button type="submit">Predict</button>
    </form>

    {% if prediction %}
        <h2>Predictions</h2>
        <p>Average Boardings: {{ prediction.boardings }}</p>
        <p>Average Alightings: {{ prediction.alightings }}</p>
    {% endif %}
</body>
</html>
