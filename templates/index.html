<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passenger Activity Prediction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
        }
        select, button {
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Passenger Activity Prediction</h1>
    <form id="predictionForm">
        <div class="form-group">
            <label for="schedule_period">Select Schedule Period:</label>
            <select id="schedule_period" onchange="fetchRouteNumbers()" required>
                <option value="Summer 2025">Summer 2025</option>
                <option value="Fall 2025">Fall 2025</option>
                <option value="Spring 2025">Spring 2025</option>
                <option value="Winter 2026">Winter 2026</option>
            </select>
        </div>
        <div class="form-group">
            <label for="route_number">Select Route Number:</label>
            <select id="route_number" onchange="fetchRouteNames()" required>
                <option value="">Select a schedule period first</option>
            </select>
        </div>
        <div class="form-group">
            <label for="route_name">Select Route Name:</label>
            <select id="route_name" required>
                <option value="">Select a route number first</option>
            </select>
        </div>
        <div class="form-group">
            <label for="day_type">Select Day Type:</label>
            <select id="day_type" required>
                <option value="Weekday">Weekday</option>
                <option value="Saturday">Saturday</option>
                <option value="Sunday">Sunday</option>
            </select>
        </div>
        <div class="form-group">
            <label for="time_period">Select Time Period:</label>
            <select id="time_period" required>
                <option value="Morning">Morning</option>
                <option value="Mid-Day">Mid-Day</option>
                <option value="PM Peak">PM Peak</option>
                <option value="Evening">Evening</option>
                <option value="Night">Night</option>
            </select>
        </div>
        <button type="button" onclick="getPrediction()">Get Prediction</button>
    </form>

    <h2>Prediction Results:</h2>
    <div id="results"></div>

    <script>
        async function fetchRouteNumbers() {
            const schedulePeriod = document.getElementById('schedule_period').value;
            const payload = { schedule_period_name: schedulePeriod, stop_number: 10637 };
            
            const response = await fetch('/get_route_numbers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });

            const data = await response.json();
            const routeNumberDropdown = document.getElementById('route_number');
            routeNumberDropdown.innerHTML = data.route_numbers.map(route => `<option value="${route}">${route}</option>`).join('');
        }

        async function fetchRouteNames() {
            const schedulePeriod = document.getElementById('schedule_period').value;
            const routeNumber = document.getElementById('route_number').value;
            const payload = { schedule_period_name: schedulePeriod, stop_number: 10637, route_number: routeNumber };
            
            const response = await fetch('/get_route_names', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });

            const data = await response.json();
            const routeNameDropdown = document.getElementById('route_name');
            routeNameDropdown.innerHTML = data.route_names.map(name => `<option value="${name}">${name}</option>`).join('');
        }

        async function getPrediction() {
            const payload = {
                schedule_period_name: document.getElementById('schedule_period').value,
                route_number: document.getElementById('route_number').value,
                route_name: document.getElementById('route_name').value,
                day_type: document.getElementById('day_type').value,
                time_period: document.getElementById('time_period').value,
            };

            const response = await fetch('/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });

            const data = await response.json();
            document.getElementById('results').innerHTML = `
                <p><strong>Boardings Prediction:</strong> ${data.boardings_prediction.toFixed(2)}</p>
                <p><strong>Alightings Prediction:</strong> ${data.alightings_prediction.toFixed(2)}</p>
            `;
        }
    </script>
</body>
</html>
