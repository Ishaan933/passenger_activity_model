<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transit Prediction Model</title>
    <script>
        async function updateRouteNames() {
            const routeNumber = document.getElementById('route_number').value;

            // Check if route number is selected
            if (!routeNumber) {
                // Clear route_name dropdown if no route_number is selected
                const routeNameDropdown = document.getElementById('route_name');
                routeNameDropdown.innerHTML = '<option value="">Select a Route Name</option>';
                return;
            }

            try {
                // Send a POST request to /get_route_names
                const response = await fetch('/get_route_names', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ route_number: routeNumber })
                });

                if (response.ok) {
                    const routeNames = await response.json();

                    // Update the route_name dropdown
                    const routeNameDropdown = document.getElementById('route_name');
                    routeNameDropdown.innerHTML = ''; // Clear existing options
                    routeNames.forEach(name => {
                        const option = document.createElement('option');
                        option.value = name;
                        option.textContent = name || 'Select a Route Name';
                        routeNameDropdown.appendChild(option);
                    });
                } else {
                    console.error("Failed to fetch route names:", response.statusText);
                }
            } catch (error) {
                console.error("Error fetching route names:", error);
            }
        }
    </script>
</head>
<body>
    <h1>Transit Prediction Model</h1>

    <form action="/predict" method="POST">
        <label for="schedule_period_name">Schedule Period Name:</label>
        <select id="schedule_period_name" name="schedule_period_name" required>
            {% for period in schedule_periods %}
                <option value="{{ period }}">{{ period or 'Select a Schedule Period' }}</option>
            {% endfor %}
        </select><br><br>

        <label for="route_number">Route Number:</label>
        <select id="route_number" name="route_number" required onchange="updateRouteNames()">
            {% for number in route_numbers %}
                <option value="{{ number }}">{{ number or 'Select a Route Number' }}</option>
            {% endfor %}
        </select><br><br>

        <label for="route_name">Route Name:</label>
        <select id="route_name" name="route_name" required>
            <option value="">Select a Route Name</option>
        </select><br><br>

        <label for="day_type">Day Type:</label>
        <select id="day_type" name="day_type" required>
            {% for day in day_types %}
                <option value="{{ day }}">{{ day or 'Select a Day Type' }}</option>
            {% endfor %}
        </select><br><br>

        <label for="time_period">Time Period:</label>
        <select id="time_period" name="time_period" required>
            {% for period in time_periods %}
                <option value="{{ period }}">{{ period or 'Select a Time Period' }}</option>
            {% endfor %}
        </select><br><br>

        <button type="submit">Predict</button>
    </form>

    {% if prediction %}
        <h2>Predictions</h2>
        <p>Average Boardings: {{ prediction.boardings }}</p>
        <p>Average Alightings: {{ prediction.alightings }}</p>
    {% endif %}

    {% if error %}
        <h2 style="color: red;">Error</h2>
        <p>{{ error }}</p>
    {% endif %}
</body>
</html>
